# 中文字体显示修复说明

## 问题描述
在Streamlit Cloud部署后，`Interaction Type Distribution`图表中的中文字体（如"对话"、"行为"、"共同出现"）无法正常显示。

## 问题原因
Streamlit Cloud服务器运行在Linux环境中，可能没有安装中文字体（如Arial Unicode MS、SimHei等），导致matplotlib无法正确渲染中文字符。

## 解决方案

### 1. 动态字体检测和配置
添加了 `setup_chinese_font()` 函数，能够：
- 自动检测系统中可用的中文字体
- 优先使用Linux系统常见的中文字体（如WenQuanYi、Noto Sans CJK等）
- 如果找不到中文字体，会尝试查找包含CJK、Chinese、Han等关键词的字体
- 设置matplotlib的全局字体配置

### 2. 字体列表优先级
按以下顺序查找可用字体：
1. Arial Unicode MS (macOS)
2. SimHei (Windows)
3. Microsoft YaHei (Windows)
4. WenQuanYi Micro Hei (Linux)
5. WenQuanYi Zen Hei (Linux)
6. Noto Sans CJK SC (Linux/通用)
7. Noto Sans CJK TC (Linux/通用)
8. Source Han Sans CN (Linux/通用)
9. DejaVu Sans (回退字体)

### 3. 图表字体设置
在所有使用中文的图表中，明确设置了字体属性：
- **Interaction Type Distribution**: x轴标签、标题、坐标轴标签
- **Network Graph**: 节点标签、标题
- **Interaction Frequency Chart**: y轴标签（人物名称）、标题、坐标轴标签

## 修改的文件

### `4_streamlit_app.py`
1. 添加了 `matplotlib.font_manager` 导入
2. 添加了 `setup_chinese_font()` 函数，返回字体名称和FontProperties对象
3. 在应用启动时调用字体配置函数
4. 在所有图表创建时明确设置字体属性
5. 使用 `FontProperties` 对象设置networkx标签字体

### `packages.txt`（新增）
包含中文字体包，Streamlit Cloud会自动安装：
- fonts-noto-cjk
- fonts-wqy-microhei  
- fonts-wqy-zenhei

## 测试建议

### 本地测试
```bash
streamlit run 4_streamlit_app.py
```
检查所有图表中的中文是否正常显示。

### Streamlit Cloud测试
1. 将修改后的代码推送到GitHub
2. Streamlit Cloud会自动重新部署
3. 检查以下图表中的中文显示：
   - Interaction Type Distribution的x轴标签
   - Network Graph中的人物名称
   - Interaction Frequency Chart中的人物名称

## 如果仍然无法显示中文

如果修复后仍然无法显示中文，可以尝试以下方案：

### 方案1：使用packages.txt安装系统字体（推荐）
项目已包含 `packages.txt` 文件，Streamlit Cloud会自动安装中文字体包：
- `fonts-noto-cjk` - Noto Sans CJK字体
- `fonts-wqy-microhei` - 文泉驿微米黑
- `fonts-wqy-zenhei` - 文泉驿正黑

**注意**：确保 `packages.txt` 文件已推送到GitHub仓库。

### 方案2：使用字体文件
1. 下载一个免费的中文字体文件（如Noto Sans CJK）
2. 将字体文件放在项目的 `fonts/` 目录中
3. 修改代码，使用 `matplotlib.font_manager.FontProperties` 加载字体文件

### 方案3：检查字体是否安装成功
在Streamlit应用中添加调试信息，查看检测到的字体：
```python
st.write(f"检测到的中文字体: {CHINESE_FONT}")
```

## 当前状态
✅ 代码已修改完成
✅ 语法检查通过
✅ 字体配置已优化

## 下一步
1. 提交代码到GitHub
2. 等待Streamlit Cloud自动重新部署
3. 检查图表中的中文显示是否正常

## 注意事项
- Streamlit Cloud的免费版可能资源有限，字体检测可能需要一些时间
- 如果系统中有多个中文字体，会使用第一个找到的
- 字体配置在应用启动时执行一次，之后所有图表都会使用相同的字体设置

